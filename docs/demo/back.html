<!doctype html>
<html lang="en">

  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>bonze - back demo</title>
    <link rel="stylesheet" href="_demo.css" />
  </head>

  <body>
    <header id="header"></header>

    <main>
      <h1>bonze <code>.back()</code></h1>
      <p class="subtitle">
        Returns the previous bonze instance in the chain - the selection that
        existed before the last traversal method. If there is no previous state,
        returns itself.
      </p>

      <!-- Scene 2: the key use case -->
      <div class="scene">
        <h2>The key use case - act on a subset, then return</h2>
        <p class="desc">
          Apply an operation to a subset of elements, call <code>.back()</code>,
          then act on a different subset - all in one chain.
        </p>

        <div class="grid" id="s2-items">
          <div class="item">item-1</div>
          <div class="item">item-2</div>
          <div class="item">item-3</div>
          <div class="item">item-4</div>
          <div class="item">item-5</div>
          <div class="item">item-6</div>
        </div>

        <div class="controls">
          <button id="s2-chain">even() .back() odd()</button>
          <button id="s2-triple">
            first() .back() last() .back() nth(2)
          </button>
          <button class="ghost" id="s2-reset">reset</button>
        </div>

        <pre id="s2-code">// click a button</pre>
      </div>

      <!-- Scene 3: back on root returns itself -->
      <div class="scene">
        <h2>No previous state - returns itself</h2>
        <p class="desc">
          If <code>.back()</code> is called on the initial selection (no
          traversal before it), it returns the same bonze instance - safe to
          call at any depth.
        </p>

        <div class="grid" id="s3-items">
          <div class="item">item-1</div>
          <div class="item">item-2</div>
          <div class="item">item-3</div>
        </div>

        <div class="controls">
          <button id="s3-back">$('...').back() - returns self</button>
        </div>

        <pre id="s3-code"></pre>
      </div>
    </main>

    <footer id="footer"></footer>

    <script type="module">
      import $ from 'https://unpkg.com/bonze/dist/bonze.esm.js'
      import { setCode, loadHeader, loadFooter } from './demo.js'

      loadHeader('back')
      loadFooter()

      // Scene 2 - practical chaining
      function reset2() {
        $("#s2-items .item")((el) =>
          el.classList.remove("hl", "src", "changed"),
        );
      }

      $("#s2-chain")((el) =>
        el.addEventListener("click", () => {
          reset2();
          $("#s2-items .item")
            .even(($el) => $el.classList.add("hl"))
            .back()
            .odd(($el) => $el.classList.add("src"));
          setCode(
            "#s2-code",
            "$('.item')\n" +
            "  .even(($el) => $el.classList.add('yellow'))\n" +
            "  .back()\n" +
            "  .odd(($el) => $el.classList.add('blue'))",
          );
        }),
      );

      $("#s2-triple")((el) =>
        el.addEventListener("click", () => {
          reset2();
          $("#s2-items .item")
            .first(($el) => $el.classList.add("hl"))
            .back()
            .last(($el) => $el.classList.add("src"))
            .back()
            .nth(2, ($el) => $el.classList.add("changed"));
          setCode(
            "#s2-code",
            "$('.item')\n" +
            "  .first(($el) => $el.classList.add('yellow'))\n" +
            "  .back()\n" +
            "  .last(($el) => $el.classList.add('blue'))\n" +
            "  .back()\n" +
            "  .nth(2, ($el) => $el.classList.add('red'))",
          );
        }),
      );

      $("#s2-reset")((el) =>
        el.addEventListener("click", () => {
          reset2();
          setCode("#s2-code", "// click a button");
        }),
      );

      // Scene 3 - back on root

      setCode(
        "#s3-code",
        "$('.item').back() // no _prev â†’ returns itself\n$('.item').back().back() // still the same instance",
      );

      $("#s3-back")((el) =>
        el.addEventListener("click", () => {
          const sel = $("#s3-items .item");
          const back = sel.back();
          $("#s3-items .item")((el) => el.classList.remove("hl", "src"));
          sel.back()(($el) => $el.classList.add("hl"));
          if (back === sel) {
            sel(($el) => $el.classList.add("src"));
          }
        }),
      );
    </script>
  </body>

</html>